<!DOCTYPE html>
<html>

<body>
    <h1>Sticky Noise Test</h1>
    <canvas id="c" width="200" height="200"></canvas>
    <script>
        function hash(str) {
            let h = 0xdeadbeef;
            for (let i = 0; i < str.length; i++) {
                h = Math.imul(h ^ str.charCodeAt(i), 2654435761);
                h = ((h << 13) | (h >>> 19));
            }
            return h >>> 0;
        }

        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = "red";
        ctx.fillRect(10, 10, 100, 100);

        // Get Data URL (should be noisy)
        const dataUrl = canvas.toDataURL();
        const dataHash = hash(dataUrl);

        console.log("DataURL Hash:", dataHash);

        // Emit telemetry
        const evt = [{
            api_name: "STICKY_TEST",
            surface_name: "Canvas.toDataURL",
            output_hash: dataHash,
            frame_type: "top",
            run_id: "test",
            persona_id: "test", // Will be overwritten by crawler
            timing_ms: 0,
            error_flag: false
        }];
        console.log("__PAL_TELEM__:" + JSON.stringify(evt));
    </script>
</body>

</html>