<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PAL Verification</title>
    <style>
        body {
            font-family: monospace;
            background: #222;
            color: #eee;
            padding: 20px;
        }

        .card {
            background: #333;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        h2 {
            margin-top: 0;
            color: #818cf8;
        }

        .row {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #444;
            padding: 5px 0;
        }

        .label {
            color: #aaa;
        }

        .value {
            color: #4ade80;
            font-weight: bold;
        }

        .warn {
            color: #f87171;
        }
    </style>
</head>

<body>
    <h1>PAL Detection Status</h1>
    <button onclick="window.location.reload()" style="padding: 10px; margin-bottom: 20px; cursor: pointer;">RELOAD PAGE
        (Check Persistence)</button>

    <div class="card">
        <h2>Navigator</h2>
        <div id="nav-results"></div>
    </div>

    <div class="card">
        <h2>Screen</h2>
        <div id="screen-results"></div>
    </div>

    <div class="card">
        <h2>WebGL</h2>
        <div id="webgl-results"></div>
    </div>

    <div class="card">
        <h2>Canvas Fingerprint (Local Test)</h2>
        <div id="canvas-results"></div>
    </div>

    <script>
        function addRow(containerId, label, value) {
            const el = document.getElementById(containerId);
            const row = document.createElement('div');
            row.className = 'row';
            row.innerHTML = `<span class="label">${label}</span><span class="value">${value}</span>`;
            el.appendChild(row);
        }

        // Simple Hash Function
        function cyrb53(str, seed = 0) {
            let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;
            for (let i = 0, ch; i < str.length; i++) {
                ch = str.charCodeAt(i);
                h1 = Math.imul(h1 ^ ch, 2654435761);
                h2 = Math.imul(h2 ^ ch, 1597334677);
            }
            h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);
            h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);
            return 4294967296 * (2097151 & h2) + (h1 >>> 0);
        }

        // Canvas Test
        try {
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 50;
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = "top";
            ctx.font = "14px 'Arial'";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125, 1, 62, 20);
            ctx.fillStyle = "#069";
            ctx.fillText("PAL_TEST", 2, 15);
            ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
            ctx.fillText("PAL_TEST", 4, 17);

            const dataUrl = canvas.toDataURL();
            const hash = cyrb53(dataUrl);

            addRow('canvas-results', 'Signature (Hash)', hash);
            addRow('canvas-results', 'Data Length', dataUrl.length);

            // Debug: Show if noise is visible?
            // document.body.appendChild(canvas); 
        } catch (e) {
            addRow('canvas-results', 'Error', e.message);
        }

        // Navigator

        addRow('nav-results', 'User Agent', navigator.userAgent);
        addRow('nav-results', 'Platform', navigator.platform);
        addRow('nav-results', 'Hardware Concurrency', navigator.hardwareConcurrency);
        addRow('nav-results', 'Device Memory', navigator.deviceMemory || 'N/A');

        // Screen
        addRow('screen-results', 'Dimensions', `${screen.width} x ${screen.height}`);
        addRow('screen-results', 'Avail Dimensions', `${screen.availWidth} x ${screen.availHeight}`);
        addRow('screen-results', 'Color Depth', screen.colorDepth);

        // WebGL
        try {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                if (debugInfo) {
                    const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
                    const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                    addRow('webgl-results', 'Unmasked Vendor', vendor);
                    addRow('webgl-results', 'Unmasked Renderer', renderer);
                } else {
                    addRow('webgl-results', 'Debug Info', 'Not Supported');
                }
            } else {
                addRow('webgl-results', 'WebGL', 'Not Supported');
            }
        } catch (e) {
            addRow('webgl-results', 'Error', e.message);
        }
    </script>
</body>

</html>